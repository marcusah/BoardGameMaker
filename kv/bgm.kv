#:import VirtualScreenManagerStack utils.virtual_screen.VirtualScreenManagerStack
#:import VirtualScreenManagerGrid utils.virtual_screen.VirtualScreenManagerGrid
#:import kivy_data_dir kivy.kivy_data_dir
#:import join os.path.join

#:import BGGDeck sgm.BGDeckMaker

<ImageButton@ButtonBehavior+BoxLayout>:
    source: None
    text: ""
    Image:
        source: root.source
        size_hint_x: .2
    Label:
        text: root.text
        size_hint_x: .8

<LabelButton@ButtonBehavior+Label>:

<WriteFilePopup@Popup>:
    cb: None
    BoxLayout:
        orientation: 'vertical'
        FileChooserListView:
        #:import get_last_dir conf.get_last_dir
            path: get_last_dir()
            on_selection: target.text = self.selection[0]
            id: fselect
        BoxLayout:
            size_hint_y: None
            height: 30
            Label:
                text: "Filename:"
                size_hint_x: None
                width: 100
            TextInput:
                id: target
        BoxLayout:
            size_hint_y: None
            height: 30
            Button:
                text: 'Apply'
                on_press: root.dismiss(); root.cb(target.text)
            Button:
                text: "Cancel"
                on_press: root.dismiss()


#Main Widget
<RootWidget>:

    orientation: "vertical"
    BoxLayout:
        pos_hint: {'top':1}
        size_hint_y: None
        height: 40
        id: message_bar
        ImageButton:
            id: app_action
            size_hint_x: None
            width: 200
            on_press: content.activated = not(content.activated)
            source: 'img/%s.png'%content.current_screen.name
            text: 'Board Game Maker: '
        Spinner:
            id: screen_spinner
            size_hint_x: None
            width: 100
            on_text: root.screen_name = self.text
            text: "Deck"
            values: 'Deck','Browser','Designer', 'Layout', 'Settings'#,'Console','Script',
        LabelButton:
            id: message
            on_press: app.alert('')# dismiss message
    VirtualScreenManagerGrid:
        orientation: 'horizontal'
        spacing: 20
        use_keyboard_shortcut: True
        scancode: 32 #space
        modifiers: ['ctrl']
        id: content
        on_children: if len(self.children)==2 and not(self.children[0].manager.activated): screen_spinner.text =  self.children[0].wrapped.name

        BGDeckMaker:
            id: deck
            name: 'Deck'

    FloatLayout:
        size_hint_y: None
        height: 0
        id: realizer
